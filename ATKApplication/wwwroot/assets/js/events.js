import{r as s,j as e,c as _,R as H}from"./EventForm-chunk.js";import{S as J}from"./Sidebar-chunk.js";const K=({onFilter:a})=>{const[c,l]=s.useState(""),[n,o]=s.useState(""),[h,d]=s.useState([]),[x,j]=s.useState("");s.useEffect(()=>{(async()=>{try{const b=await(await fetch("/api/ref/organizations/municipalities")).json();l(b)}catch(f){console.error("Ошибка при загрузке муниципалитетов: ",f)}})()},[]),s.useEffect(()=>{if(!n){d([]);return}fetch(`/api/ref/organizations/departments?municipality=${n}`).then(t=>t.json()).then(d).catch(t=>console.error("Ошибка при загрузке департаментов",t))},[n]);const[r,m]=s.useState(!1),[u,p]=s.useState(""),[v,y]=s.useState(""),[k,C]=s.useState(!1),[E,w]=s.useState(!1),[N,F]=s.useState(!1),[L,z]=s.useState(!1),[O,P]=s.useState(!1),[M,R]=s.useState(!1),[T,I]=s.useState(""),[Q,q]=s.useState([]),[$,A]=s.useState(""),[B,D]=s.useState("");s.useEffect(()=>{fetch("/api/ref/themes").then(t=>t.json()).then(t=>q(t)).catch(t=>console.error("Ошибка загрузки тем:",t))},[]);const G=()=>m(!r),U=()=>{function t(b){const g=new URLSearchParams;return Object.entries(b).forEach(([S,i])=>{typeof i=="string"&&i.trim()!==""?g.append(S,i.trim()):typeof i=="number"&&!isNaN(i)?g.append(S,i.toString()):typeof i=="boolean"&&i===!0&&g.append(S,"true")}),g.toString()}const f=t({municipality:n,organization:x,level:v,important:k,peerFormat:E,bestPractice:N,interagency:L,feedback:O,theme:T,financing:M,dateFrom:$,dateTo:B});a&&a(f)};return e.jsxs("div",{className:"control-panel-wrapper",children:[e.jsxs("div",{className:"control-panel",children:[e.jsx("input",{type:"text",placeholder:"Поиск мероприятий...",value:u,onChange:t=>p(t.target.value)}),e.jsx("button",{onClick:()=>window.location.href="/create",children:"Создать мероприятие"}),e.jsx("button",{onClick:G,children:r?"Скрыть фильтры":"Фильтрация"})]}),r&&e.jsxs("div",{className:"filters",children:[e.jsxs("div",{className:"row",children:[e.jsxs("select",{id:"municipality",value:n,onChange:t=>o(t.target.value),children:[e.jsx("option",{value:"",children:"Выбор муниципалитета"}),c.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:x,onChange:t=>j(t.target.value),disabled:!h.length,children:[e.jsx("option",{value:"",children:"-- Выберите подразделение --"}),h.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:v,onChange:t=>y(t.target.value),children:[e.jsx("option",{value:"",children:"Уровень мероприятия"}),e.jsx("option",{value:"Муниципальный",children:"Муниципальный"}),e.jsx("option",{value:"Региональный",children:"Региональный"}),e.jsx("option",{value:"Всероссийский",children:"Всероссийский"}),e.jsx("option",{value:"Международный",children:"Международный"})]})]}),e.jsxs("select",{value:T,onChange:t=>I(t.target.value),className:"theme-select",children:[e.jsx("option",{value:"",children:"Выбрать тему"}),Q.map(t=>e.jsx("option",{value:t.code,title:t.description,children:t.code},t.code))]}),e.jsxs("div",{className:"date-filter",children:[e.jsx("label",{children:"Дата от:"}),e.jsx("input",{type:"date",value:$,onChange:t=>A(t.target.value)})]}),e.jsxs("div",{className:"date-filter",children:[e.jsx("label",{children:"Дата до:"}),e.jsx("input",{type:"date",value:B,onChange:t=>D(t.target.value)})]}),e.jsxs("div",{className:"checkboxes",children:[e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:k,onChange:t=>C(t.target.checked)})," Важное"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:E,onChange:t=>w(t.target.checked)})," Формат равный равному"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:N,onChange:t=>F(t.target.checked)})," Лучшие практики"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:L,onChange:t=>z(t.target.checked)})," Межведомственное взаимодействие"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:O,onChange:t=>P(t.target.checked)})," Обратная связь"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:M,onChange:t=>R(t.target.checked)})," Есть финансирование"]})]}),e.jsx("button",{className:"filter-submit",onClick:U,children:"Фильтровать"}),e.jsx("button",{type:"button",className:"filter-reset",onClick:()=>{p(""),o(""),j(""),y(""),I(""),C(!1),w(!1),F(!1),z(!1),P(!1),R(!1),A(""),D("")},children:"Сбросить фильтры"})]})]})};function V({data:a,error:c,loading:l}){return!a||a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"10",children:"Нет данных для отображения"})}):l?e.jsx("tr",{children:e.jsx("td",{colSpan:"10",children:"Загрузка данных c сервера..."})}):c?e.jsx("tr",{children:e.jsxs("td",{colSpan:"10",children:["Ошибка: ",c]})}):e.jsx(e.Fragment,{children:a.map(n=>{var o;return e.jsxs("tr",{children:[e.jsx("td",{children:n.themeCode??"—"}),e.jsx("td",{children:n.name??"—"}),e.jsx("td",{children:n.content??"—"}),e.jsx("td",{children:n.date??"—"}),e.jsx("td",{children:n.participantsCount??0}),e.jsx("td",{children:((o=n.links)==null?void 0:o.length)>0?n.links.map((h,d)=>e.jsx("div",{children:e.jsx("a",{href:h,target:"_blank",rel:"noopener noreferrer",children:h})},d)):"—"}),e.jsx("td",{children:e.jsx("button",{className:"details-btn",onClick:()=>window.location.href=`/events/${n.id}`,children:"Подробнее"})})]},n.id)})})}const W=()=>{const[a,c]=s.useState([]),[l,n]=s.useState(!0),[o,h]=s.useState(null),[d,x]=s.useState(""),j=async(r="")=>{const m=r?`/api/ref/events/sort?${r}`:"/api/ref/events";try{const u=await fetch(m);if(!u.ok)throw new Error("Ошибка при загрузке данных");const p=await u.json();c(p)}catch(u){h(u.message)}finally{n(!1)}};return s.useEffect(()=>{j(d)},[d]),e.jsxs(e.Fragment,{children:[e.jsx(K,{onFilter:r=>x(r)}),e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"№ темы"}),e.jsx("th",{children:"Наименование"}),e.jsx("th",{children:"Описание"}),e.jsx("th",{children:"Дата"}),e.jsx("th",{children:"Количество участников"}),e.jsx("th",{children:"Ссылки"}),e.jsx("th",{children:"Управление"})]})}),e.jsx("tbody",{children:e.jsx(V,{data:a,error:o,loading:l})})]})]})};function X(){const[a,c]=s.useState(!1),l=()=>c(!a);return e.jsxs("div",{className:"App",children:[e.jsx(J,{isOpen:a,toggleSidebar:l}),e.jsx(W,{})]})}const Y=document.getElementById("root"),Z=_.createRoot(Y);Z.render(e.jsxs(H.StrictMode,{children:[e.jsx(X,{})," "]}));
