import{r as a,j as e,c as $,R as B}from"./EventForm-chunk.js";import{S as A}from"./Sidebar-chunk.js";const w=({onFilter:r})=>{const[d,x]=a.useState(!1),[k,v]=a.useState(""),[S,g]=a.useState(""),[y,f]=a.useState(""),[m,s]=a.useState(""),[c,i]=a.useState(!1),[o,u]=a.useState(!1),[b,h]=a.useState(!1),[l,j]=a.useState(!1),[n,p]=a.useState(!1),[C,F]=a.useState(!1),[N,E]=a.useState(""),[M,O]=a.useState([]),[D,I]=a.useState(""),[z,T]=a.useState("");a.useEffect(()=>{fetch("/api/ref/themes").then(t=>t.json()).then(t=>O(t)).catch(t=>console.error("Ошибка загрузки тем:",t))},[]);const L=()=>x(!d),R=()=>{r({search:k,municipality:S,organization:y,level:m,important:c,peerFormat:o,bestPractice:b,interagency:l,feedback:n,theme:N,funding:C,dateFrom:D,dateTo:z})};return e.jsxs("div",{className:"control-panel-wrapper",children:[e.jsxs("div",{className:"control-panel",children:[e.jsx("input",{type:"text",placeholder:"Поиск мероприятий...",value:k,onChange:t=>v(t.target.value)}),e.jsx("button",{onClick:()=>window.location.href="/create",children:"Создать мероприятие"}),e.jsx("button",{onClick:L,children:d?"Скрыть фильтры":"Фильтрация"})]}),d&&e.jsxs("div",{className:"filters",children:[e.jsxs("div",{className:"row",children:[e.jsxs("select",{value:S,onChange:t=>g(t.target.value),children:[e.jsx("option",{value:"",children:"Выбор муниципалитета"}),e.jsx("option",{value:"Муниципалитет 1",children:"Муниципалитет 1"}),e.jsx("option",{value:"Муниципалитет 2",children:"Муниципалитет 2"}),e.jsx("option",{value:"Муниципалитет 3",children:"Муниципалитет 3"}),e.jsx("option",{value:"Муниципалитет 4",children:"Муниципалитет 4"}),e.jsx("option",{value:"Муниципалитет 5",children:"Муниципалитет 5"})]}),e.jsxs("select",{value:y,onChange:t=>f(t.target.value),children:[e.jsx("option",{value:"",children:"Выбор организации"}),e.jsx("option",{value:"Организация А",children:"Организация А"}),e.jsx("option",{value:"Организация Б",children:"Организация Б"}),e.jsx("option",{value:"Организация В",children:"Организация В"}),e.jsx("option",{value:"Организация Г",children:"Организация Г"}),e.jsx("option",{value:"Организация Д",children:"Организация Д"})]}),e.jsxs("select",{value:m,onChange:t=>s(t.target.value),children:[e.jsx("option",{value:"",children:"Уровень мероприятия"}),e.jsx("option",{value:"Муниципальный",children:"Муниципальный"}),e.jsx("option",{value:"Региональный",children:"Региональный"}),e.jsx("option",{value:"Всероссийский",children:"Всероссийский"}),e.jsx("option",{value:"Международный",children:"Международный"})]})]}),e.jsxs("select",{value:N,onChange:t=>E(t.target.value),className:"theme-select",children:[e.jsx("option",{value:"",children:"Выбрать тему"}),M.map(t=>e.jsx("option",{value:t.code,title:t.description,children:t.code},t.code))]}),e.jsxs("div",{className:"date-filter",children:[e.jsx("label",{children:"Дата от:"}),e.jsx("input",{type:"date",value:D,onChange:t=>I(t.target.value)})]}),e.jsxs("div",{className:"date-filter",children:[e.jsx("label",{children:"Дата до:"}),e.jsx("input",{type:"date",value:z,onChange:t=>T(t.target.value)})]}),e.jsxs("div",{className:"checkboxes",children:[e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:c,onChange:t=>i(t.target.checked)})," Важное"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:o,onChange:t=>u(t.target.checked)})," Формат равный равному"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:b,onChange:t=>h(t.target.checked)})," Лучшие практики"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:l,onChange:t=>j(t.target.checked)})," Межведомственное взаимодействие"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:n,onChange:t=>p(t.target.checked)})," Обратная связь"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:C,onChange:t=>F(t.target.checked)})," Есть финансирование"]})]}),e.jsx("button",{className:"filter-submit",onClick:R,children:"Фильтровать"}),e.jsx("button",{type:"button",className:"filter-reset",onClick:()=>{v(""),g(""),f(""),s(""),E(""),i(!1),u(!1),h(!1),j(!1),p(!1),F(!1),I(""),T(""),r({},[])},children:"Сбросить фильтры"})]})]})};function G({itemsPerPage:r=10,children:d}){const[x,k]=a.useState([]),[v,S]=a.useState(!0),[g,y]=a.useState(null),[f,m]=a.useState(1);function s(b){const h={января:"01",февраля:"02",марта:"03",апреля:"04",мая:"05",июня:"06",июля:"07",августа:"08",сентября:"09",октября:"10",ноября:"11",декабря:"12"},l=b.split(" ");if(l.length!==3)return"";const j=l[0].padStart(2,"0"),n=h[l[1]];return`${l[2]}-${n}-${j}`}a.useEffect(()=>{(async()=>{const h="/api/ref/events";try{const l=await fetch(h);if(!l.ok)throw new Error("Ошибка при загрузке данных");const j=await l.json();console.log("Полученные мероприятия:",j);const n=j.map(p=>({...p,date:s(p.date)}));k(n)}catch(l){y(l.message)}finally{S(!1)}})()},[]);const c=Math.ceil(x.length/r),i=f*r,o=i-r,u=x.slice(o,i);return d(v?{loading:!0}:g?{error:g}:{events:u,currentPage:f,setCurrentPage:m,totalPages:c,loading:!1,error:null})}const _=()=>{const[r,d]=a.useState(null),x=10,[k,v]=a.useState(1),[S,g]=a.useState(""),[y,f]=a.useState(""),m=(s,c)=>{const i=c.filter(o=>{var u;return(!s.search||((u=o.name)==null?void 0:u.toLowerCase().includes(s.search.toLowerCase())))&&(!s.municipality||o.municipality===s.municipality)&&(!s.organization||o.organization===s.organization)&&(!s.level||o.level===s.level)&&(!s.important||o.isImportant===!0)&&(!s.peerFormat||o.peerFormat===!0)&&(!s.bestPractice||o.bestPractice===!0)&&(!s.interagency||o.interagency===!0)&&(!s.feedback||o.feedback===!0)&&(!s.funding||o.funding===!0)&&(!s.theme||o.themeCode===s.theme)&&(!s.dateFrom||new Date(o.date)>=new Date(s.dateFrom))});d(i)};return e.jsx("div",{className:"table-container",children:e.jsx(G,{itemsPerPage:1e5,children:({events:s,currentPage:c,setCurrentPage:i,totalPages:o,loading:u,error:b})=>{const h=r??s,l=h?Math.ceil(h.length/x):1,j=h?h.slice((c-1)*x,c*x):[];return u?e.jsxs(e.Fragment,{children:[e.jsx(w,{onFilter:n=>m(n,s)}),e.jsx("table",{children:e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:"10",children:"Загрузка данных c сервера..."})})})})]}):b?e.jsxs(e.Fragment,{children:[e.jsx(w,{onFilter:n=>m(n,s)}),e.jsx("table",{children:e.jsx("tbody",{children:e.jsx("tr",{children:e.jsxs("td",{colSpan:"10",children:["Ошибка: ",b]})})})})]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{onFilter:n=>m(n,s)}),e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"№ темы"}),e.jsx("th",{children:"Наименование"}),e.jsx("th",{children:"Описание"}),e.jsx("th",{children:"Дата"}),e.jsx("th",{children:"Количество участников"}),e.jsx("th",{children:"Ссылки"}),e.jsx("th",{children:"Управление"})]})}),e.jsx("tbody",{children:j.map(n=>{var p;return e.jsxs("tr",{children:[e.jsx("td",{children:n.themeCode??"—"}),e.jsx("td",{children:n.name??"—"}),e.jsx("td",{children:n.content??"—"}),e.jsx("td",{children:n.date??"—"}),e.jsx("td",{children:n.participantsCount??0}),e.jsx("td",{children:((p=n.links)==null?void 0:p.length)>0?n.links.map((C,F)=>e.jsx("div",{children:e.jsx("a",{href:C,target:"_blank",rel:"noopener noreferrer",children:C})},F)):"—"}),e.jsx("td",{children:e.jsx("button",{className:"details-btn",onClick:()=>window.location.href=`/events/${n.id}`,children:"Подробнее"})})]},n.id)})})]}),e.jsxs("div",{className:"pagination",children:[e.jsx("button",{onClick:()=>i(n=>Math.max(n-1,1)),disabled:c===1,children:"◀"}),c>2&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>i(1),children:"1"}),c>3&&e.jsx("span",{children:"..."})]}),c>1&&e.jsx("button",{onClick:()=>i(c-1),children:c-1}),e.jsx("button",{className:"active",children:c}),c<l&&e.jsx("button",{onClick:()=>i(c+1),children:c+1}),c<l-1&&e.jsxs(e.Fragment,{children:[c<l-2&&e.jsx("span",{children:"..."}),e.jsx("button",{onClick:()=>i(l),children:l})]}),e.jsx("button",{onClick:()=>i(n=>Math.min(n+1,l)),disabled:c===l,children:"▶"})]})]})}})})};function q(){const[r,d]=a.useState(!1),x=()=>d(!r);return e.jsxs("div",{className:"App",children:[e.jsx(A,{isOpen:r,toggleSidebar:x}),e.jsx(_,{})]})}const H=document.getElementById("root"),J=$.createRoot(H);J.render(e.jsxs(B.StrictMode,{children:[e.jsx(q,{})," "]}));
